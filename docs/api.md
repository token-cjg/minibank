<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# migrate

```go
import "github.com/token-cjg/minibank/cmd/migrate"
```

## Index



# seed

```go
import "github.com/token-cjg/minibank/cmd/seed"
```

cmd/seed/main.go

## Index



# server

```go
import "github.com/token-cjg/minibank/cmd/server"
```

## Index



# api

```go
import "github.com/token-cjg/minibank/internal/api"
```

Package api provides the HTTP server and routing for the application. It uses the Gorilla Mux router for handling HTTP requests and responses. The server is responsible for defining the API endpoints and their handlers. It also sets up the necessary middleware for logging and error handling.

## Index

- [type Server](<#Server>)
  - [func New\(rep \*repo.Repo\) \*Server](<#New>)
  - [func \(s \*Server\) ServeHTTP\(w http.ResponseWriter, r \*http.Request\)](<#Server.ServeHTTP>)


<a name="Server"></a>
## type Server



```go
type Server struct {
    // contains filtered or unexported fields
}
```

<a name="New"></a>
### func New

```go
func New(rep *repo.Repo) *Server
```



<a name="Server.ServeHTTP"></a>
### func \(\*Server\) ServeHTTP

```go
func (s *Server) ServeHTTP(w http.ResponseWriter, r *http.Request)
```



# db

```go
import "github.com/token-cjg/minibank/internal/db"
```

Package db provides a database connection for the application. It uses the pgx driver for PostgreSQL and sets up connection pooling. The connection pool settings are configured to optimize performance.

## Index

- [func New\(\) \(\*sql.DB, error\)](<#New>)


<a name="New"></a>
## func New

```go
func New() (*sql.DB, error)
```



# handler

```go
import "github.com/token-cjg/minibank/internal/handler"
```

Package handler provides HTTP handlers for managing accounts and transactions.

## Index

- [Constants](<#constants>)
- [type Account](<#Account>)
  - [func NewAccount\(r \*repo.Repo\) \*Account](<#NewAccount>)
  - [func \(h \*Account\) Create\(w http.ResponseWriter, r \*http.Request\)](<#Account.Create>)
  - [func \(h \*Account\) GetByID\(w http.ResponseWriter, r \*http.Request\)](<#Account.GetByID>)
  - [func \(h \*Account\) ListByCompany\(w http.ResponseWriter, r \*http.Request\)](<#Account.ListByCompany>)
- [type Company](<#Company>)
  - [func NewCompany\(r \*repo.Repo\) \*Company](<#NewCompany>)
  - [func \(h \*Company\) Create\(w http.ResponseWriter, r \*http.Request\)](<#Company.Create>)
  - [func \(h \*Company\) GetByID\(w http.ResponseWriter, r \*http.Request\)](<#Company.GetByID>)
  - [func \(h \*Company\) List\(w http.ResponseWriter, r \*http.Request\)](<#Company.List>)
- [type Transfer](<#Transfer>)
  - [func NewTransfer\(r \*repo.Repo\) \*Transfer](<#NewTransfer>)
  - [func \(h \*Transfer\) Batch\(w http.ResponseWriter, r \*http.Request\)](<#Transfer.Batch>)


## Constants

<a name="FileUploadField"></a>

```go
const FileUploadField = "file"
```

<a name="Account"></a>
## type Account



```go
type Account struct{ Repo *repo.Repo }
```

<a name="NewAccount"></a>
### func NewAccount

```go
func NewAccount(r *repo.Repo) *Account
```



<a name="Account.Create"></a>
### func \(\*Account\) Create

```go
func (h *Account) Create(w http.ResponseWriter, r *http.Request)
```

Create is a handler for creating a new account.

```
POST /companies/{id}/accounts
Content-Type: application/json
Body: {"initial_balance": 1000.0}
```

<a name="Account.GetByID"></a>
### func \(\*Account\) GetByID

```go
func (h *Account) GetByID(w http.ResponseWriter, r *http.Request)
```

GetByID is a handler for getting an account by its ID.

```
GET /companies/{id}/accounts/{id}
```

<a name="Account.ListByCompany"></a>
### func \(\*Account\) ListByCompany

```go
func (h *Account) ListByCompany(w http.ResponseWriter, r *http.Request)
```

ListByCompany is a handler for listing all accounts for a company.

```
GET /companies/{id}/accounts
```

<a name="Company"></a>
## type Company



```go
type Company struct{ Repo *repo.Repo }
```

<a name="NewCompany"></a>
### func NewCompany

```go
func NewCompany(r *repo.Repo) *Company
```



<a name="Company.Create"></a>
### func \(\*Company\) Create

```go
func (h *Company) Create(w http.ResponseWriter, r *http.Request)
```

Create is a handler for creating a new company.

```
POST /companies
Content-Type: application/json
Body: {"company_name": "Company Name"}
```

<a name="Company.GetByID"></a>
### func \(\*Company\) GetByID

```go
func (h *Company) GetByID(w http.ResponseWriter, r *http.Request)
```

GetByID is a handler for getting a company by ID.

```
GET /companies/{id}
```

<a name="Company.List"></a>
### func \(\*Company\) List

```go
func (h *Company) List(w http.ResponseWriter, r *http.Request)
```

List is a handler for listing all companies.

```
GET /companies
```

<a name="Transfer"></a>
## type Transfer



```go
type Transfer struct{ Repo *repo.Repo }
```

<a name="NewTransfer"></a>
### func NewTransfer

```go
func NewTransfer(r *repo.Repo) *Transfer
```



<a name="Transfer.Batch"></a>
### func \(\*Transfer\) Batch

```go
func (h *Transfer) Batch(w http.ResponseWriter, r *http.Request)
```

Batch is a handler for transferring money between accounts.

- POST /transfer
- Content\-Type: multipart/form\-data
- Body: \{"file": \<file\>\}
- OR
- Content\-Type: text/csv
- Body: \<csv data\>
- CSV format: \<source\_account\_id\>,\<target\_account\_id\>,\<amount\>
- Example:
- 1,2,100.50
- 3,4,200.00
- 5,6,300.75
- Returns:
- 201 Created
- 400 Bad Request if the CSV is malformed or the request is not multipart/form\-data
- 500 Internal Server Error if the server encounters an error
- Notes:
- \- The CSV file can be uploaded as a file part in a multipart/form\-data request.
- \- The CSV file can also be sent as a text/csv request body.
- \- The CSV file must contain three columns: source\_account\_id, target\_account\_id, and amount.
- \- The source\_account\_id and target\_account\_id must be valid account IDs.
- \- The amount must be a valid float64 value.
- \- The transfer will be processed in a batch, and the response will indicate the status of the transfer.
- \- The transfer will be processed in the order they appear in the CSV file.

# model

```go
import "github.com/token-cjg/minibank/internal/model"
```

Package model contains the data structures used in the application. It is used to define the data models for the database entities. The models are used in the repository layer to interact with the database.

## Index

- [type Account](<#Account>)
- [type Company](<#Company>)
- [type Transaction](<#Transaction>)


<a name="Account"></a>
## type Account



```go
type Account struct {
    ID      int64   `json:"account_id"`
    Company int64   `json:"company_id"`
    Number  string  `json:"account_number"`
    Balance float64 `json:"account_balance"`
}
```

<a name="Company"></a>
## type Company



```go
type Company struct {
    ID   int64  `json:"company_id"`
    Name string `json:"company_name"`
}
```

<a name="Transaction"></a>
## type Transaction



```go
type Transaction struct {
    ID        int64   `json:"tx_id"`
    Source    int64   `json:"source_account_id"`
    Target    int64   `json:"target_account_id"`
    Amount    float64 `json:"transfer_amount"`
    Error     *string `json:"error,omitempty"`
    CreatedAt string  `json:"created_at"`
}
```

# repo

```go
import "github.com/token-cjg/minibank/internal/repo"
```

Package repo provides a repository for managing user accounts and transactions. It contains methods for creating, updating, and deleting accounts, as well as for transferring money between accounts.

## Index

- [Variables](<#variables>)
- [type BatchError](<#BatchError>)
- [type Repo](<#Repo>)
  - [func New\(db \*sql.DB\) \*Repo](<#New>)
  - [func \(r \*Repo\) BatchTransfer\(ctx context.Context, txns \[\]TransferInput\) \*BatchError](<#Repo.BatchTransfer>)
  - [func \(r \*Repo\) CreateAccount\(ctx context.Context, companyID int64, balance float64\) \(model.Account, error\)](<#Repo.CreateAccount>)
  - [func \(r \*Repo\) CreateCompany\(ctx context.Context, name string\) \(model.Company, error\)](<#Repo.CreateCompany>)
  - [func \(r \*Repo\) GetAccountByID\(ctx context.Context, accountID int64\) \(model.Account, error\)](<#Repo.GetAccountByID>)
  - [func \(r \*Repo\) GetCompanyByID\(ctx context.Context, companyID int64\) \(model.Company, error\)](<#Repo.GetCompanyByID>)
  - [func \(r \*Repo\) ListAccountsByCompany\(ctx context.Context, companyID int64\) \(\[\]model.Account, error\)](<#Repo.ListAccountsByCompany>)
  - [func \(r \*Repo\) ListCompanies\(ctx context.Context\) \(\[\]model.Company, error\)](<#Repo.ListCompanies>)
  - [func \(r \*Repo\) Transfer\(ctx context.Context, srcNum, dstNum int64, amount float64\) error](<#Repo.Transfer>)
- [type TransferInput](<#TransferInput>)


## Variables

<a name="ErrInsufficient"></a>ErrInsufficient is a sentinel error for insufficient balance

```go
var ErrInsufficient = errors.New("insufficient balance")
```

<a name="BatchError"></a>
## type BatchError



```go
type BatchError struct {
    Row int   // index in csv of the transaction that failed
    Err error // underlying error (e.g. ErrInsufficient, pq error, etc.)
}
```

<a name="Repo"></a>
## type Repo



```go
type Repo struct {
    // contains filtered or unexported fields
}
```

<a name="New"></a>
### func New

```go
func New(db *sql.DB) *Repo
```



<a name="Repo.BatchTransfer"></a>
### func \(\*Repo\) BatchTransfer

```go
func (r *Repo) BatchTransfer(ctx context.Context, txns []TransferInput) *BatchError
```



<a name="Repo.CreateAccount"></a>
### func \(\*Repo\) CreateAccount

```go
func (r *Repo) CreateAccount(ctx context.Context, companyID int64, balance float64) (model.Account, error)
```



<a name="Repo.CreateCompany"></a>
### func \(\*Repo\) CreateCompany

```go
func (r *Repo) CreateCompany(ctx context.Context, name string) (model.Company, error)
```



<a name="Repo.GetAccountByID"></a>
### func \(\*Repo\) GetAccountByID

```go
func (r *Repo) GetAccountByID(ctx context.Context, accountID int64) (model.Account, error)
```



<a name="Repo.GetCompanyByID"></a>
### func \(\*Repo\) GetCompanyByID

```go
func (r *Repo) GetCompanyByID(ctx context.Context, companyID int64) (model.Company, error)
```



<a name="Repo.ListAccountsByCompany"></a>
### func \(\*Repo\) ListAccountsByCompany

```go
func (r *Repo) ListAccountsByCompany(ctx context.Context, companyID int64) ([]model.Account, error)
```



<a name="Repo.ListCompanies"></a>
### func \(\*Repo\) ListCompanies

```go
func (r *Repo) ListCompanies(ctx context.Context) ([]model.Company, error)
```



<a name="Repo.Transfer"></a>
### func \(\*Repo\) Transfer

```go
func (r *Repo) Transfer(ctx context.Context, srcNum, dstNum int64, amount float64) error
```



<a name="TransferInput"></a>
## type TransferInput



```go
type TransferInput struct {
    Source int64
    Target int64
    Amount float64
}
```

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
